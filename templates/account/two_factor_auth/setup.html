{% extends "base/base.html" %}

{% block title %}Setup two-factor authentication &mdash; {{ block.super }}{% endblock %}
{% block subtitle %}Setup two-factor authentication{% endblock %}

{% block container %}

{% if form.non_field_errors %}
<div class="has-error">
  {% for x in form.non_field_errors %}
  <p class="help-block">{{ x }}</p>
  {% endfor %}
</div>
{% endif %}

<form action="" method="POST">
  {% csrf_token %}
  {{ wizard.management_form }}

  {% switch wizard.steps.current %}
  {% case "welcome" %}
    <p>
      You are about to take your account security to the next level. Follow
      the steps in this wizard to enable two-factor authentication.
    </p>

    <button class="btn btn-primary" type="submit">Next</button>
  {% endcase %}
  {% case "generator" %}
    <p>
      To start using a token generator, please use your smartphone to scan
      the QR code below. For example, use Google Authenticator. Then, enter
      the token generated by the app.
    </p>
    <p>
      <img src="{{ QR_URL }}" alt="QR Code">
    </p>

    <div class="form-group {% if form.errors.token %}has-error{% endif %}">
      <label for="{{ form.token.id_for_label }}">
        Token
      </label>
      <input
        id="{{ form.token.id_for_label }}"
        type="number"
        class="form-control"
        name="{{ form.token.html_name }}"
        value="{{ form.token.value|default:"" }}"
        maxlength="{{ form.token.field.max_length|default:"" }}"
        {% if form.token.field.required %}required{% endif %}
      >
      {% for x in form.errors.token %}
        <p class="help-block">{{ x }}</p>
      {% endfor %}
    </div>

    <button class="btn btn-primary btn-lg" type="submit">Validate token</button>

    <p class="mt-5">
      Alternatively, you can copy-paste the following code:
      <strong>{{ qr_key }}</strong>
    </p>
  {% endcase %}
  {% endswitch %}
</form>

{% endblock %}
